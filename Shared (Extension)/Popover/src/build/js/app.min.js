`use strict`;

function SafariWallet () {
	this.opened = false;

	const html = `<div class="popover"><h1>Connect to Mirror</h1><p class="subtitle">mirror.xyz</p><p>When you connect your wallet, this dapp will be able to view the contents:</p><div class="field"><label class="field__label" for="address">Address</label> <input id="address" class="field__input" type="text" value="0x255E9B54F41F44F42150b6aAA730Da5f2d23Faf2" disabled="disabled"></div><div class="field"><label class="field__label" for="balance">ETH Balance</label> <input id="balance" class="field__input" type="text" value="12.142 ETH" disabled="disabled"></div><div class="field"><label class="field__label" for="ens">ENS records</label> <input id="ens" class="field__input" type="text" value="ric.eth" disabled="disabled"></div><div class="flex"><button class="button button--secondary" onclick="(() => window.safariWallet.close())();">Cancel</button> <button class="button button--primary">Connect</button></div></div>`;
	this.popover = document.createElement(`div`);
	this.popover.innerHTML = html;

	const css = `@media (prefers-reduced-motion:reduce){*{-webkit-animation:none!important;animation:none!important;-webkit-transition-duration:0s!important;transition-duration:0s!important}}@font-face{font-display:swap;font-family:Graphik;src:local("Graphik"),url(Graphik.otf) format("opentype")}*{-webkit-box-sizing:border-box;box-sizing:border-box}.popover{background-color:#262626;bottom:0;font-family:Graphik,system-ui;margin:0;padding:0 7px;position:fixed;text-align:center;width:100%;z-index:10000000000}.popover h1{color:#fff;font-size:20px;font-weight:600;line-height:22px;margin:28px 0 8px}.popover p{color:rgba(255,255,255,.8);font-size:18px;line-height:20px;margin:0 0 22px}.popover .subtitle{font-size:17px;line-height:19px;margin-bottom:27px;text-align:center}.popover .field{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.popover .field__label{color:rgba(219,219,219,.8);font-size:14px;line-height:15px;margin-left:12px;text-align:left}.popover .field__input{background-color:transparent;border:1px solid #404040;border-radius:7px;color:#fff;font-family:"SF Mono",system-ui;font-size:15px;height:38px;line-height:18px;margin:4px 0 8px}.popover .flex{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-column-gap:14px;-moz-column-gap:14px;column-gap:14px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.popover .button{border-radius:7px;font-size:20px;line-height:22px;height:53px;max-width:200px;width:100%}.popover .button.button--secondary{background-color:#313131;border:1px solid #414141;color:rgba(255,255,255,.7)}.popover .button.button--primary{background-color:#306ee3;border:1px solid #437deb;color:#fff}`;
	this.style = document.createElement(`style`);
	this.style.setAttribute(`type`, `text/css`);
	this.style.innerHTML = css;
	document.body.appendChild(this.style);
}

SafariWallet.prototype.open = () => {
	if (window.safariWallet.opened === false) {
		window.safariWallet.opened = true;
		document.body.insertBefore(window.safariWallet.popover, document.body.firstChild);
	}
};

SafariWallet.prototype.close = () => {
	if (!!window.safariWallet.opened) {
		document.body.removeChild(window.safariWallet.popover);
		window.safariWallet.opened = false;
	}
};

// For older browsers:
typeof window.addEventListener === `undefined` && (window.addEventListener = (e, cb) => window.attachEvent(`on${e}`, cb));

window.addEventListener(`load`, () => {

	if (typeof window.safariWallet === `undefined`) {
		window.safariWallet = new SafariWallet();
	}

});